<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Article Network</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0e27;
      color: #e0e0e0;
      overflow: hidden;
    }

    #canvas {
      display: block;
      width: 100%;
      height: 100vh;
    }

    #info {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(10, 14, 39, 0.9);
      backdrop-filter: blur(10px);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      max-width: 300px;
      font-size: 12px;
      z-index: 10;
    }

    #info h3 {
      margin-bottom: 8px;
      font-size: 14px;
      color: #fff;
    }

    #info p {
      margin: 4px 0;
      color: #a0a0a0;
    }

    #stats {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: rgba(10, 14, 39, 0.9);
      backdrop-filter: blur(10px);
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 11px;
      font-family: 'Courier New', monospace;
    }

    #controls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 14, 39, 0.95);
      backdrop-filter: blur(10px);
      padding: 12px 15px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 11px;
      z-index: 10;
    }

    #controls div {
      margin: 4px 0;
      color: #7aa3ff;
    }

    #panel-toggle {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(122, 163, 255, 0.2);
      border: 1px solid rgba(122, 163, 255, 0.5);
      color: #7aa3ff;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      z-index: 20;
      transition: all 0.2s;
    }

    #panel-toggle:hover {
      background: rgba(122, 163, 255, 0.4);
    }

    #vision-panel {
      position: absolute;
      bottom: 20px;
      left: 140px;
      width: 320px;
      background: rgba(10, 14, 39, 0.98);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(122, 163, 255, 0.3);
      border-radius: 10px;
      padding: 18px;
      z-index: 15;
      display: none;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    #vision-panel.open {
      display: block;
    }

    .panel-section {
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      padding-bottom: 12px;
    }

    .panel-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .panel-label {
      color: #7aa3ff;
      font-size: 11px;
      font-weight: bold;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .panel-value {
      color: #a0a0a0;
      font-size: 11px;
    }

    input[type="range"] {
      width: 100%;
      height: 4px;
      border-radius: 2px;
      background: rgba(255, 255, 255, 0.1);
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 6px;
      background: #7aa3ff;
      cursor: pointer;
      box-shadow: 0 0 8px rgba(122, 163, 255, 0.5);
    }

    input[type="range"]::-moz-range-thumb {
      width: 12px;
      height: 12px;
      border-radius: 6px;
      background: #7aa3ff;
      cursor: pointer;
      border: none;
      box-shadow: 0 0 8px rgba(122, 163, 255, 0.5);
    }

    .toggle-switch {
      display: inline-flex;
      width: 40px;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 2px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .toggle-switch.active {
      background: rgba(122, 163, 255, 0.5);
    }

    .toggle-knob {
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s;
    }

    .toggle-switch.active .toggle-knob {
      transform: translateX(20px);
    }

  </style>
</head>
<body>
  <div id="canvas"></div>

  <div id="info">
    <h3>üåê Article Network</h3>
    <p id="article-title">Select an article</p>
    <p id="article-emotion">---</p>
    <p id="article-type">---</p>
    <p id="article-stance">---</p>
  </div>

  <button id="panel-toggle">‚öôÔ∏è Vision Controls</button>

  <div id="vision-panel">
    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
      <div style="color: #fff; font-size: 13px; font-weight: bold;">Space-Vision Optimizer</div>
    </div>

    <div class="panel-section">
      <div class="panel-label">
        <span>Orbital Speed</span>
        <span class="panel-value" id="speed-val">1.0x</span>
      </div>
      <input type="range" id="orbital-speed" min="0" max="3" step="0.1" value="1" />
    </div>

    <div class="panel-section">
      <div class="panel-label">
        <span>Orbital Radius</span>
        <span class="panel-value" id="radius-val">80</span>
      </div>
      <input type="range" id="orbital-radius" min="30" max="150" step="5" value="80" />
    </div>

    <div class="panel-section">
      <div class="panel-label">
        <span>Card Scale</span>
        <span class="panel-value" id="scale-val">1.0x</span>
      </div>
      <input type="range" id="card-scale" min="0.5" max="2" step="0.1" value="1" />
    </div>

    <div class="panel-section">
      <div class="panel-label">
        <span>Lighting</span>
        <span class="panel-value" id="light-val">1.2x</span>
      </div>
      <input type="range" id="lighting" min="0.3" max="2" step="0.1" value="1.2" />
    </div>

    <div class="panel-section">
      <div class="panel-label">
        <span>Scene Rotation</span>
        <span class="panel-value" id="rotation-val">Auto</span>
      </div>
      <div class="toggle-switch" id="auto-rotate">
        <div class="toggle-knob"></div>
      </div>
    </div>

    <div class="panel-section">
      <div class="panel-label">
        <span>Connection Lines</span>
        <span class="panel-value" id="lines-val">On</span>
      </div>
      <div class="toggle-switch active" id="show-lines">
        <div class="toggle-knob"></div>
      </div>
    </div>

    <div class="panel-section">
      <div class="panel-label">
        <span>Featured Card</span>
        <span class="panel-value" id="featured-val">Visible</span>
      </div>
      <div class="toggle-switch active" id="show-featured">
        <div class="toggle-knob"></div>
      </div>
    </div>

    <div class="panel-section">
      <div class="panel-label">
        <span>Z-Depth Variation</span>
        <span class="panel-value" id="depth-val">Medium</span>
      </div>
      <input type="range" id="depth-variation" min="0" max="1" step="0.1" value="0.5" />
    </div>
  </div>

  <div id="stats">
    <div>FPS: <span id="fps">60</span></div>
    <div>Cards: <span id="card-count">0</span></div>
    <div>Links: <span id="link-count">0</span></div>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // Global settings
    const settings = {
      orbitalSpeedMultiplier: 1,
      orbitalRadius: 80,
      cardScale: 1,
      lighting: 1.2,
      autoRotate: false,
      showLines: true,
      showFeatured: true,
      depthVariation: 0.5
    };

    // Sample data - article cards
    const articles = [
      {
        id: '1',
        title: 'The Future of AI in Healthcare',
        content: 'Exploring how machine learning transforms diagnostic accuracy...',
        emotion: 'hopeful',
        type: 'argument',
        author: 'Dr. Smith',
        stance: 'pro-ai',
        upvotes: 245,
        related: ['2', '3']
      },
      {
        id: '2',
        title: 'AI Ethics and Data Privacy',
        content: 'Examining the critical concerns around personal data in AI systems...',
        emotion: 'analytical',
        type: 'evidence',
        author: 'Prof. Johnson',
        stance: 'cautious',
        upvotes: 189,
        related: ['1', '4']
      },
      {
        id: '3',
        title: 'Machine Learning Breakthrough',
        content: 'New neural network architecture achieves unprecedented performance...',
        emotion: 'passionate',
        type: 'news',
        author: 'Tech Weekly',
        stance: 'optimistic',
        upvotes: 412,
        related: ['1', '5']
      },
      {
        id: '4',
        title: 'Concerns About AI Bias',
        content: 'Systemic biases in training data lead to unfair outcomes...',
        emotion: 'frustrated',
        type: 'critique',
        author: 'Ethics Lab',
        stance: 'critical',
        upvotes: 178,
        related: ['2', '6']
      },
      {
        id: '5',
        title: 'AI in Creative Industries',
        content: 'How generative AI is reshaping art, music, and design...',
        emotion: 'curious',
        type: 'analysis',
        author: 'Creative Tech',
        stance: 'experimental',
        upvotes: 234,
        related: ['3', '7']
      },
      {
        id: '6',
        title: 'Regulation and AI Development',
        content: 'Policy frameworks needed for responsible AI deployment...',
        emotion: 'analytical',
        type: 'policy',
        author: 'Government Tech',
        stance: 'regulatory',
        upvotes: 156,
        related: ['2', '4']
      },
      {
        id: '7',
        title: 'Real-World AI Applications',
        content: 'Success stories from companies implementing AI solutions...',
        emotion: 'hopeful',
        type: 'case-study',
        author: 'Business Daily',
        stance: 'pragmatic',
        upvotes: 298,
        related: ['3', '5']
      },
      {
        id: '8',
        title: 'The AI Skills Gap',
        content: 'Education and training challenges in the AI era...',
        emotion: 'concerned',
        type: 'survey',
        author: 'Education Forum',
        stance: 'advocacy',
        upvotes: 145,
        related: ['6', '9']
      },
      {
        id: '9',
        title: 'Open Source AI Models',
        content: 'Democratizing AI development through open collaboration...',
        emotion: 'passionate',
        type: 'opinion',
        author: 'Open Source Advocate',
        stance: 'pro-open',
        upvotes: 267,
        related: ['5', '8']
      },
      {
        id: '10',
        title: 'Environmental Impact of AI',
        content: 'Energy consumption and carbon footprint of large models...',
        emotion: 'fearful',
        type: 'research',
        author: 'Climate Tech',
        stance: 'environmentalist',
        upvotes: 189,
        related: ['6', '8']
      }
    ];

    // Emotion colors
    const emotionColors = {
      hopeful: 0x4CAF50,
      analytical: 0x2196F3,
      frustrated: 0xFF5722,
      passionate: 0xFF1744,
      fearful: 0xFF6F00,
      curious: 0x9C27B0,
      concerned: 0xFF9100,
      passionate: 0xE91E63
    };

    // Three.js setup
    const container = document.getElementById('canvas');
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0a0e27);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
    camera.position.z = 150;

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.shadowMap.enabled = true;
    container.appendChild(renderer.domElement);

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 1.2);
    scene.add(ambientLight);

    const pointLight = new THREE.PointLight(0xffffff, 1.2);
    pointLight.position.set(100, 100, 100);
    scene.add(pointLight);

    // Position articles in 3D space
    const positions = [];
    const cardMeshes = [];
    const cardData = [];

    function getRandomPosition() {
      const radius = settings.orbitalRadius;
      const phi = Math.random() * Math.PI * 2;
      const theta = Math.acos(Math.random() * 2 - 1);
      return [
        radius * Math.sin(theta) * Math.cos(phi),
        radius * Math.sin(theta) * Math.sin(phi),
        radius * Math.cos(theta)
      ];
    }

    // Canvas for text texture
    function createTextTexture(article) {
      const canvas = document.createElement('canvas');
      canvas.width = 512;
      canvas.height = 512;
      const ctx = canvas.getContext('2d');

      // Paper white background
      ctx.fillStyle = '#f5f5f0';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Subtle border with emotion color
      const color = emotionColors[article.emotion] || 0x2196F3;
      ctx.strokeStyle = `#${color.toString(16).padStart(6, '0')}`;
      ctx.lineWidth = 2;
      ctx.strokeRect(0, 0, canvas.width, canvas.height);

      // Title
      ctx.fillStyle = '#1a1a1a';
      ctx.font = 'bold 24px Arial';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'top';

      // Word wrap for title
      const titleWords = article.title.split(' ');
      let line = '';
      let y = 20;
      titleWords.forEach(word => {
        const testLine = line + word + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > 450) {
          ctx.fillText(line, 20, y);
          line = word + ' ';
          y += 28;
        } else {
          line = testLine;
        }
      });
      ctx.fillText(line, 20, y);

      y += 35;

      // Content
      ctx.fillStyle = '#333333';
      ctx.font = '13px Arial';
      ctx.lineHeight = 1.6;

      const contentWords = article.content.split(' ');
      line = '';
      contentWords.forEach(word => {
        const testLine = line + word + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > 450) {
          ctx.fillText(line, 20, y);
          line = word + ' ';
          y += 16;
        } else {
          line = testLine;
        }
        if (y > 400) return; // Prevent overflow
      });
      if (line && y <= 400) ctx.fillText(line, 20, y);

      // Bottom badges and info
      ctx.fillStyle = '#666666';
      ctx.font = 'bold 12px Arial';
      ctx.fillText(article.emotion + ' ‚Ä¢ ' + article.type, 20, canvas.height - 40);
      ctx.fillText('By: ' + article.author, 20, canvas.height - 20);

      // Upvotes
      ctx.fillText('üëç ' + article.upvotes, canvas.width - 120, canvas.height - 20);

      const texture = new THREE.CanvasTexture(canvas);
      return texture;
    }

    // Pick a random featured article
    const featuredIdx = Math.floor(Math.random() * articles.length);
    const featuredArticle = articles[featuredIdx];
    let featuredMesh = null;

    // Create card meshes with billboard effect
    articles.forEach((article, idx) => {
      const isFeatured = idx === featuredIdx;
      let position;

      if (isFeatured) {
        position = [0, 0, 0]; // Centered at origin
      } else {
        position = getRandomPosition();
      }

      positions.push(position);

      // Create card geometry (flat plane)
      const geometry = isFeatured
        ? new THREE.PlaneGeometry(100, 100)  // Large featured card
        : new THREE.PlaneGeometry(40, 40);

      // Create materials with text texture
      const texture = createTextTexture(article);
      const material = new THREE.MeshBasicMaterial({
        map: texture,
        side: THREE.DoubleSide
      });

      const mesh = new THREE.Mesh(geometry, material);
      mesh.position.set(...position);
      mesh.userData = { article, index: idx, isBillboard: true, isFeatured };

      if (isFeatured) {
        featuredMesh = mesh;
      }

      scene.add(mesh);
      cardMeshes.push(mesh);
      cardData.push({ mesh, article, position });
    });

    // Draw connections between related articles
    const connections = [];
    articles.forEach((article, idx) => {
      article.related.forEach(relatedId => {
        const relatedIdx = articles.findIndex(a => a.id === relatedId);
        if (relatedIdx > idx) { // Avoid duplicate lines
          const geometry = new THREE.BufferGeometry();
          const pos = [
            ...positions[idx],
            ...positions[relatedIdx]
          ];
          geometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(pos), 3));

          const material = new THREE.LineBasicMaterial({
            color: 0x4a5568,
            transparent: true,
            opacity: 0.3
          });

          const line = new THREE.Line(geometry, material);
          scene.add(line);
          connections.push(line);
        }
      });
    });

    // Mouse raycasting
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    let selectedCard = null;

    window.addEventListener('mousemove', (event) => {
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(cardMeshes);

      if (intersects.length > 0) {
        container.style.cursor = 'pointer';
      } else {
        container.style.cursor = 'grab';
      }
    });

    window.addEventListener('click', (event) => {
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(cardMeshes);

      if (intersects.length > 0) {
        const article = intersects[0].object.userData.article;
        updateInfoPanel(article);
      }
    });

    function updateInfoPanel(article) {
      document.getElementById('article-title').textContent = article.title;
      document.getElementById('article-emotion').textContent = `Emotion: ${article.emotion}`;
      document.getElementById('article-type').textContent = `Type: ${article.type}`;
      document.getElementById('article-stance').textContent = `Stance: ${article.stance}`;
    }

    // Mouse controls
    let isDragging = false;
    let rotationX = 0;
    let rotationY = 0;

    window.addEventListener('mousedown', () => { isDragging = true; });
    window.addEventListener('mouseup', () => { isDragging = false; });

    window.addEventListener('mousemove', (event) => {
      if (isDragging && selectedCard === null) {
        rotationX += event.movementY * 0.01;
        rotationY += event.movementX * 0.01;
      }
    });

    window.addEventListener('wheel', (event) => {
      event.preventDefault();
      camera.position.z += event.deltaY * 0.1;
      camera.position.z = Math.max(40, Math.min(300, camera.position.z));
    }, { passive: false });

    // Update info
    document.getElementById('card-count').textContent = articles.length;
    document.getElementById('link-count').textContent = connections.length;

    // Show featured article in info panel
    updateInfoPanel(featuredArticle);

    // Animation loop
    let frameCount = 0;
    let lastTime = Date.now();

    function animate() {
      requestAnimationFrame(animate);

      // Rotation
      scene.rotation.x = rotationX;
      scene.rotation.y = rotationY;

      // Static positioning - cards never move
      cardMeshes.forEach((mesh, idx) => {
        // Only set position once (cards stay completely static)
        if (!mesh.userData.positionSet) {
          const pos = positions[idx];
          mesh.position.set(pos[0], pos[1], pos[2]);
          mesh.userData.positionSet = true;
        }

        // Billboard effect: make card always face camera (no damping)
        mesh.quaternion.copy(camera.quaternion);
      });

      // Auto-rotation if enabled
      if (settings.autoRotate) {
        scene.rotation.y += 0.0005;
      }

      // Update connections
      connections.forEach((line, idx) => {
        line.material.opacity = 0.25 + Math.sin(time * 2 + idx) * 0.15;
      });

      renderer.render(scene, camera);

      // FPS counter
      frameCount++;
      const currentTime = Date.now();
      if (currentTime - lastTime >= 1000) {
        document.getElementById('fps').textContent = frameCount;
        frameCount = 0;
        lastTime = currentTime;
      }
    }

    animate();

    // Handle window resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // === PANEL CONTROLS ===

    const panelToggle = document.getElementById('panel-toggle');
    const visionPanel = document.getElementById('vision-panel');

    panelToggle.addEventListener('click', () => {
      visionPanel.classList.toggle('open');
    });

    // Orbital speed control
    document.getElementById('orbital-speed').addEventListener('input', (e) => {
      settings.orbitalSpeedMultiplier = parseFloat(e.target.value);
      document.getElementById('speed-val').textContent = settings.orbitalSpeedMultiplier.toFixed(1) + 'x';
    });

    // Orbital radius control
    document.getElementById('orbital-radius').addEventListener('input', (e) => {
      settings.orbitalRadius = parseInt(e.target.value);
      document.getElementById('radius-val').textContent = settings.orbitalRadius;
      // Recalculate positions
      positions.length = 0;
      articles.forEach((article, idx) => {
        const isFeatured = idx === featuredIdx;
        if (isFeatured) {
          positions.push([0, 0, 0]);
        } else {
          positions.push(getRandomPosition());
        }
      });
    });

    // Card scale control
    document.getElementById('card-scale').addEventListener('input', (e) => {
      settings.cardScale = parseFloat(e.target.value);
      document.getElementById('scale-val').textContent = settings.cardScale.toFixed(1) + 'x';
      cardMeshes.forEach(card => {
        card.scale.set(settings.cardScale, settings.cardScale, settings.cardScale);
      });
    });

    // Lighting control
    document.getElementById('lighting').addEventListener('input', (e) => {
      settings.lighting = parseFloat(e.target.value);
      document.getElementById('light-val').textContent = settings.lighting.toFixed(1) + 'x';
      ambientLight.intensity = settings.lighting;
      pointLight.intensity = settings.lighting;
    });

    // Auto-rotate toggle
    document.getElementById('auto-rotate').addEventListener('click', function() {
      settings.autoRotate = !settings.autoRotate;
      this.classList.toggle('active');
      document.getElementById('rotation-val').textContent = settings.autoRotate ? 'On' : 'Off';
    });

    // Connection lines toggle
    document.getElementById('show-lines').addEventListener('click', function() {
      settings.showLines = !settings.showLines;
      this.classList.toggle('active');
      document.getElementById('lines-val').textContent = settings.showLines ? 'On' : 'Off';
      connections.forEach(line => {
        line.visible = settings.showLines;
      });
    });

    // Featured card toggle
    document.getElementById('show-featured').addEventListener('click', function() {
      settings.showFeatured = !settings.showFeatured;
      this.classList.toggle('active');
      document.getElementById('featured-val').textContent = settings.showFeatured ? 'Visible' : 'Hidden';
      cardMeshes.forEach(card => {
        if (card.userData.isFeatured) {
          card.visible = settings.showFeatured;
        }
      });
    });

    // Depth variation control
    document.getElementById('depth-variation').addEventListener('input', (e) => {
      settings.depthVariation = parseFloat(e.target.value);
      const levels = ['Low', 'Medium', 'High'];
      const level = Math.floor(settings.depthVariation * 3);
      document.getElementById('depth-val').textContent = levels[Math.min(level, 2)];
    });
  </script>
</body>
</html>
